# Инструкции для участника

## Прочитайте задание полностью.

Обратите внимание на то, что задание написано не в хронологическом порядке; последовательность действий для выполнения задания остаётся на ваше усмотрение.
Выполнение задания на 100% за отведённое время теоретически возможно, но от вас не требуется выполнять задание полностью.
Распределите время работы таким образом, чтобы заработать максимальное количество баллов. Во время выполнения задания руководствуйтесь следующими полезными советами:
1. Если вам необходимо установить пароль, но в задании не указано, какой именно — установите P@ssw0rd.
2. Если вы по каким-либо причинам хотите использовать свои собственные учетные данные/адреса/DNS имена — не забудьте указать их в черновике и оставить его на вашем рабочем месте.
3. Внимательно проверяйте свою работу. Если эксперты не смогут подключиться к чему-либо по какой-либо причине (сетевая недоступность, не подходят учетные данные) — проверка этого устройства производится не будет.
4. Любые дополнительные комментарии и пожелания на проверку вы можете оставить для экспертов в черновике. Ваши комментарии гарантированно будут прочитаны перед проверкой или во время проверки.
5. Если вы столкнулись с непониманием пункта задания — поднимите руку и спросите.
6. Вы можете расходовать ваше время так, как вам этого хочется. Помните, что время, затраченное на ваши нужды, не компенсируется, за исключением обеда и случаев проблем со стороны площадки.

# Легенда конкурсного задания

По легенде конкурсного задания ваша организация - Холдинг “CoolCompany”, занимается аудитом систем информационной безопасности, а также проводит разработку собственного коммерческого продукта - “Afisha Today”. Это платформа для малых предприятий и частных лиц в индустрии развлечений и досуга. Платформа за фиксированную комиссию предлагает разместить объявление на открытом ресурсе. Платформа берёт на себя обязательства помочь с регистрацией слушателей и полное информационное сопровождение мероприятий.

Компания имеет серверную стойку в ЦОД, офис в Москве, аренду виртуальной машины в публичном облаке “Cloud Happy” а также недавно Холдинг вышел на новый рынок, завершив покупку ГК “Минералы Урала” - вся ИТ-инфраструктура горнодобывающей компании, как и все её процессы, теперь перешли в ответственность “CoolCompany”. Ранее в организации “Минералы Урала” работала другая ИТ-компания и совершенно не оставила документации после себя. Необходимо будет исправить текущие процессы и проверить работу.

## Используемые операционные системы:

| Наименование виртуальной машины  | Версия операционной системы  |  Режим работы |
|---|---|---|
| DC-MAILSERVER  | Debian 12  | Неграфический сервер  |
| DC-STORAGE  | Debian 12  | Неграфический сервер  |
| DC-RTR-2  | Debian 12  | Неграфический сервер  |
| DC-RTR-1  | Debian 12  | Неграфический сервер  |
| REMOTE-TERMINAL  | Astra Linux 1.7  | Графический клиент, режим работы “Воронеж”  |
| MOOGLE  | Участнику недоступен  | Участнику недоступен  |
| AZAZON  | Участнику недоступен  | Участнику недоступен  |
| REPO-MIRROR  | Участнику недоступен  | Участнику недоступен  |
| CLOUD-VM  | Debian 12  | Неграфический сервер  |
| MSK-RTR  | Debian 12  | Неграфический сервер  |
| MSK-DC  | Astra Linux 1.7  | Графический сервер, режим работы “Воронеж”  |
| MSK-ADMINPC  | Astra Linux 1.7  | Графический сервер, режим работы “Воронеж”  |
| MSK-WORKER  | Astra Linux 1.7  | Графический сервер, режим работы “Воронеж”  |
| MSK-GITLAB  | Debian 12  | Неграфический сервер  |
| YEKT-RTR  | Debian 12  | Неграфический сервер  |
| YEKT-BILLING  | Astra Linux 1.7  | Графический сервер, режим работы “Воронеж”  |
| YEKT-DB  | Astra Linux 1.7  | Графический сервер, режим работы “Воронеж”  |
| YEKT-WORKER  | Astra Linux 1.7  | Графический сервер, режим работы “Воронеж”  |


Машина REPO-MIRROR представляет собой прокси-сервер, выполняющий трансляцию запросов на официальные репозитории Debian 12 (mirror.yandex.ru), Ubuntu 24.04 (mirror.yandex.ru), Astra Linux 1.7 (dl.astralinux.ru).

Также, на машине REPO-MIRROR сохранены в папке /configs полезные документы и готовые файлы конфигураций, которыми будет удобно пользоваться при выполнении задания.

В инфраструктуре задания выход в “настоящий” интернет непредусмотрен, система лишь эмулирует работы реального Интернета, но напрямую выход недоступен.

На провайдере ISP (77.88.8.1) настроен DNS с следующими записями:


| DNS-запись  | Адрес  | Назначение  |
|---|---|---|
| repo.atomskills.ru  | 77.88.8.8  | Доступ к репозиторию по доменному имени  |
| vpn.atomskills.ru  | 179.13.219.70  | VPN-адрес, для подключения с компьютера REMOTE-TERMINAL  |


# Работы в ЦОД

## [✅1. На всех устройствах, указанных на топологии, создайте и настройте L3-адреса.](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/C/C_1.md)

## [✅2. Все устройства (за исключением DC-STORAGE) должны прослушивать 22 порт SSH исключительно на внутреннем интерфейсе, по протоколу IPv4. Логин доступа - cod_admin:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/C/C_2.md)

2.1 Доступ исключительно по ключу. Ключ сохраните на сервере DC-STORAGE в каталоге - /ssh_keys, у пользователя cod_admin в домашнем каталоге никаких ключей быть не должно;

2.2 Для DC-STORAGE доступ по SSH с пользователем cod_admin по паролю для подключенных пользователей через OpenConnect - пароль для подключения по SSH- At0mSk1lls;

2.3 На всех целевых машинах в датацентре пользователь cod_admin должен иметь доступ к команде sudo без запроса пароля.

## [✅3. Между DC-RTR-2,DC-RTR-1,MSK-RTR,YEKT-RTR настройте удалённый защищённый туннель:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/C/C_3.md)

3.1 В качестве инструмента защиты используйте любое решение;

3.2 Важно организовать следующую логику работы соединений:

3.3 В случае, если соединение пропадает с Московского офиса до ЦОД - канал связи автоматически перестраивается на соединение с Екатеринбургом и перенаправляет трафик через резервного провайдера;

3.4 В случае, если соединение пропадает из офиса в Екатеринбурге - канал связи аналогично переключается на Московский офис и проходит по другому каналу связи;

3.5 При восстановлении соединения, система обратно переключается на основной канал связи;

3.6 Необходимо обеспечить бесперебойную работу сервера почты для всех филиалов, используйте этот сервис в качестве проверки доступности;

3.7 Основное соединение, ровно как и резервные обязательно должны быть зашифрованы;

3.8 Вы можете самостоятельно проверить механизм отключения “провайдера”, под пользователем test с паролем P@ssw0rd в домашнем каталоге расположены скрипты, отвечающие за данную настройку;

3.9 При нормальной работе системы, туннели должны быть настроены в строгом соответствии с Топологией VPN. Дополнительные интерфейсы использовать запрещено.

## [✅4. Для обеспечения сетевого взаимодействия настройте протокол динамической маршрутизации OSPF на роутерах:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/C/C_4.md)

4.1 Обеспечьте работу OSPF только на туннельных интерфейсах;

4.2 Обеспечьте аутентификацию через в OSPF по ключу - C00lCompanY;

## [✅5. Для выхода в сеть «Интернет» используйте PAT, настроенный на пограничных роутерах соответственно.](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/C/C_5.md)

## [✅6. На базе сервера CLOUD-VM1 необходимо реализовать OpenConnect со следующей логикой работы:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/C/C_6.md)

6.1 Машина CLOUD-VM1 является публичным ресурсом и компания не скрывает её адрес, а вот адреса роутеров в ЦОДе компания не планирует опубликовывать, именно поэтому CLOUD-VM1 является брокером подключений;

6.2 Машина CLOUD-VM1 подключается только к DC-RTR-1. Отказоустойчивое соединение настраивать не планируется;

6.3 Для OpenConnect используйте сертификат, выданный основным ЦС в городе Москва.

## [✅7. Клиентский компьютер REMOTE-TERMINAL подключается на CLOUD-VM1 через OpenConnect-client. В зависимости от логина, меняется сетевая доступность внутренних ресурсов компании, таблица доступности объясняет это подробнее.](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/C/C_7.md)

Таблица доступности:

| Логин  | Доступность  | Пароль  |
|---|---|---|
| cod_admin  | Сеть ЦОД  | P@ssw0rd1234  |
| yekt_admin  | Сеть Екатеринбурга  | P@ssw0rd1234  |
| msk_admin  | Сеть Москвы  | P@ssw0rd1234  |

## [✅8. На машине DC-STORAGE реализуйте файловый сервер на базе NFS:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/C/C_8.md)

8.1 Обеспечьте автомонтирование NFS-сервера на компьютер MSK-ADMINPC и MSK-WORKER через pam_mount;

8.2 Монтирование происходит на основании членства пользователя в указанной группе;

8.3 Планируется, что все папки будут на рабочем столе пользователя;

8.4 Настройте каждую папку так, чтобы пользователи даже при наличии максимального доступа к файлам не имели права на удаление тех файлов и директорий, владельцами которых они не являются;

8.5 Права на директорию можете назначить любые, главное сохранить условие монтирование папки в нужную группу.

Таблица опубликованных файловых ресурсов:

| Директория на сервере DC-STORAGE  | Доступность группе  | Точка монтирования  |
|---|---|---|
| /storage/it  | IT  | $HOME/Desktop/IT_Folder  |
| /storage/office  | office  | $HOME/Desktop/Office_Folder  |

## [✅9. Реализуйте систему резервного копирования важных данных:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/C/C_9.md)

9.1 Необходимо сделать так, что после создания пользователем из группы OFFICE в каталоге его группы файла с именем “SAVE” в любом регистре и в любом месте наименования файла (например, saveme.txt; SAVE_Customer.docx;sAvE_billing.pdf;booking_save_plz.xslx и т.д.) файл автоматически сохранялся на отдельно смонтированный Crypto-LVM массив на сервере DC-STORAGE /crypto-folder.

9.2 В случае, если файл был удалён пользователем, то он не удаляется с места резервного копирования.

## [✅10. Реализуйте LVM-массив на DC-STORAGE по следующим требованиям:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/C/C_10.md)

10.1 LVM-массив из трёх дисков, объемом в 1ГБ ОЗУ;

10.2 Обеспечьте шифрование тома средствами dm-crypt. Диск должен монтироваться при загрузке ОС без запроса пароля;

10.3 Смонтируйте в каталог /crypto-folder;

## [✅11. На машине DC-MAILSERVER уже развернут почтовый сервер организации.](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/C/C_11.md)

11.1 Почтовая система является частью критической инфраструктуры, используйте адрес этой машины для проверки 100% доступности с филиалов.

## [✅12. Реализуйте отказоустойчивый шлюз по умолчанию в инфраструктуре ЦОД:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/C/C_12.md)

12.1 Используйте протокол VRRP (или его аналоги);

12.2 Адрес шлюза - 10.15.10.1 на всех устройствах в ЦОД.


# Настройка офиса в Москве

## [✅1. Убедитесь, что домен FreeIPA на MSK-DC1 развернут корректно:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/M/M_1.md)

1.1 Имя домена — company.cool;

1.2 На сервере настроен DNS со следующими записями, вы можете добавить собственные при необходимости.

| DNS-запись  | Адрес  | Назначение  |
|---|---|---|
| billing.company.cool  | 192.168.2.100  | Доступ к система учета в ЕКБ  |
| zabbix.company.cool  | 192.168.2.150  | Доступ к Zabbix  |
| www.company.cool  | 192.168.2.1  | Доступ к сайту для Admin и Worker  |
| gitlab.company.cool  | 192.168.1.3  | Доступ к Gitlab  |
| mail.company.cool  | 10.15.10.100  | Почтовая инфраструктура  |

## [✅2. Импортируйте пользователей в домен. Используйте для этого файл по пути - /root/users.csv;](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/M/M_2.md)

2.1 В качестве логина используйте фамилию пользователя;
2.2 В качестве пароля - P@ssw0rd;
2.3 Сделайте так, чтобы пароль не требовал смены для всех пользователей.

## [✅3. Добавьте компьютеры MSK-ADMINPC и MSK-WORKER в домен FreeIPA.](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/M/M_3.md)

## [✅4. На компьютере MSK-DC1 разверните Основной Центр сертификации:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/M/M_4.md)

Все веб-сервисы должны быть доступны только по протоколу HTTPS, OpenConnect также.

Все сертификаты должны быть выпущены Центром сертификации в городе Москва и добавлены в доверенные на всех компьютерах инфраструктуры, если в задании не сказано обратное;

Каталог для центра сертификации - /root/ca;

Имя центра сертификации - Cool CA;

Страна “Россия”;

Город “Москва”;

Область “Московская”.

## [✅5. Настройте ограничение на работу компьютера в нерабочее время:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/M/M_5.md)

5.1 Компьтер MSK-WORKER позволяет заходить на компьютер только в промежуток с 09:00 до 18:00 по МСК. Если пользователь пытается зайти вне этого времени, то после ввода логина и пароля система его не пустит. При этом активную сессию прерывать не нужно.

5.2 Локальному пользователю administrator доступ разрешить

5.3 Настройке изображение на экране блокировки таким образом, чтобы было указано “В случае необходимости доступа к рабочему месту вне регламентированных работ, напишите на почту - admin@company.cool”. Или организуйте любой другой способ информирования пользователя о необходимости связи с администраторами для получения доступа к ПК.

## [✅6. MSK-ADMINPC позволяет входить в систему только пользователям из группы IT. Остальным вход запрещен:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/M/M_6.md)

6.1 Настройте sudo для данной группы через парольную авторизацию.

## [✅7. На машине MSK-GITLAB:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/M/M_7.md)

7.1 На машине GITLAB необходимо настроить SAST.

## [✅8. Настройте DHCP-сервер на машине MSK-RTR:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/M/M_8.md)

Диапазон адресов - 192.168.1.50 - 192.168.1.100;

DNS-сервер - 192.168.1.2 и 77.88.8.1;

Домен поиска - company.cool.


# Настройка офиса в Екатеринбурге

## [✅1. На сервере YEKT-BILLING развернута самописная система контроля за добычей горных пород, система работает с базой данных на сервере YEKT-DB, необходимо исправить следующие особенности платформы:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/Y/Y_1.md)

1.1 Сервер работает медленно, выявите причину и устраните неисправность;
1.2 Согласно внутреннему регламенту компании информация о добытых горных породах храниться только в течение последних 15 лет. Данные старше следует отправить на холодное хранение на сервер DC-STORAGE в каталог /crypto-folder, а из базы данных удалить.

## [✅2. На сервере YEKT-DB уже есть сервер Zabbix:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/Y/Y_2.md)

2.1 Подключите к серверу HTTPS;

2.2 Настройте метрики Zabbix так, что в случае перегрузки CPU больше чем на 80% и переполнения диска более чем на 90%, Zabbix автоматически писал уведомления на почту - admin@company.cool.

2.3 почтовый аккаунт admin@company.cool подключен к MSK-ADMINPC для доменного пользователя - admin_infra (импортируемый из CSV-файла)

## [✅3. Сбор логов организуйте на машине YEKT-WORKER, на рабочем столе локального пользователя - yekt_admin с паролем P@ssw0rd. Директория $HOME/Desktop/Logs/, где NAME имя сервера, с которого был взят лог файл:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/Y/Y_3.md)

3.1 Логи собирать только веб-сервера на YEKT-BILLING и YEKT-DB;

3.2 Синхронизация логов происходит мгновенно;

3.3 Используйте любое техническое решение для реализации данной задачи.

## [✅4. На сервере YEKT-RTR разверните подчиненный Центр сертификации:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/Y/Y_4.md)

4.1 Подпишите подчиненный сертификат вашим основном ЦС в городе Москва;

4.2 Каталог для центра сертификации - /sub/ca;

4.3 Имя центра сертификации - Yekaterinburg CA;

4.4 Остальные сведения наследуются с основного ЦС.

## [✅5. Испольуя подчиненный Центр сертификации обеспечьте корректную работу YEKT-BILLING приложения по HTTPS.](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/Y/Y_5.md)

## [✅6. Реализуйте веб-сайт, на базе YEKT-RTR:](https://github.com/Scrocisss/ATM225SCROCK/blob/main/B/Y/Y_6.md)

6.1 веб-сайт с поддержкой авторизации согласено таблице пин-кодов;

6.2 пользователь вводит свой уникальный ПИН-код (исходя из таблицы пин-кодов);

6.3 при переходе на корневую страницу сайта пользователю предлагается на выбор две ссылки:

click here for admin;

click here for worker.

6.4 после выбора нужной ссылки для пользователя запрашивается авторизация на сайте, пользователь наблюдает HTML-страницу:

Если зашел как /admin, страница пишет - Hello Admins!

Если зашел как /worker, страница пишет - Hello Workers!

Пин-код:

| Пользователь  | пин-код  |
|---|---|
| ssl_admin  | 159753486  |
| ssl_worker  | 951753426  |
